= BWG IoT RESTful Services API Guide
Triton Services;
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 2
:sectlinks:

[[overview]]
= Overview

[[overview-http-verbs]]
== HTTP verbs

RESTful spas tries to adhere as closely as possible to standard HTTP and REST conventions in its
use of HTTP verbs.

|===
| Verb | Usage

| `GET`
| Used to retrieve a resource

| `POST`
| Used to create a new resource

| `PATCH`
| Used to update an existing resource, including partial updates

| `DELETE`
| Used to delete an existing resource
|===

[[overview-http-status-codes]]
== HTTP status codes

RESTful spas tries to adhere as closely as possible to standard HTTP and REST conventions in its
use of HTTP status codes.

|===
| Status code | Usage

| `200 OK`
| The request completed successfully

| `201 Created`
| A new resource has been created successfully. The resource's URI is available from the response's
`Location` header

| `204 No Content`
| An update to an existing resource has been applied successfully

| `400 Bad Request`
| The request was malformed. The response body will include an error providing further information

| `404 Not Found`
| The requested resource did not exist
|===

[[overview-errors]]
== Errors

Whenever an error response (status code >= 400) is returned, the body will contain a JSON object
that describes the problem. The error object has the following structure:

include::{snippets}/error-example/response-fields.adoc[]

For example, a request that attempts to apply a non-existent owner of a spa will produce a
`400 Bad Request` response:

include::{snippets}/error-example/http-response.adoc[]

[[overview-hypermedia]]
== Hypermedia

RESTful Spas uses hypermedia and resources include links to other resources in their
responses. Responses are in http://stateless.co/hal_specification.html[Hypertext Application
from resource to resource.
Language (HAL)] format. Links can be found beneath the `_links` key. Users of the API should
not create URIs themselves, instead they should use the above-described links to navigate

[[resources]]
= Resources



[[resources-index]]
== Index

The index provides the entry point into the service.



[[resources-index-access]]
=== Accessing the index

A `GET` request is used to access the index

==== Response structure

include::{snippets}/index-example/response-fields.adoc[]

==== Example response

include::{snippets}/index-example/http-response.adoc[]



[[resources-index-links]]
==== Links

include::{snippets}/index-example/links.adoc[]



[[resources-dashboard]]
== Landing Page Dashboard

The Dashboards display various statistics related to the user.

[[resources-dashboard-dealer]]
=== Get Statistics for Dashboard

A `GET` request will retrieve the dashboard statistics used to populate a web application landing page.
The return data is based on the provided role parameter.

* Dealer role returns counts for all spas related to a single dealer.
* Associate role returns statistics for all spas sold by a particular dealer sales associate. (and unsold spas)
* Technician role returns statistics for all spas assigned to the particular technician.
* OEM role returns statistics for all spas manufactured by this OEM.
* BWG role retruns statistics related to all spas in the system.

==== Request Parameters

include::{snippets}/dashboard-dealer-example/request-parameters.adoc[]

==== Response structure

include::{snippets}/dashboard-dealer-example/response-fields.adoc[]

==== Links

The links below provide access to the lists of alerts, spas, messages, and spa owners represented in the statistics.

include::{snippets}/dashboard-dealer-example/links.adoc[]


==== Example request

This example requests information for all of a dealers spas.

include::{snippets}/dashboard-dealer-example/curl-request.adoc[]

==== Example response

include::{snippets}/dashboard-dealer-example/http-response.adoc[]



[[resources-spa]]
== Spa

The Spa resource is used to retrieve, update, and delete individual spas



[[resources-spa-links]]
=== Links

include::{snippets}/spa-get-example/links.adoc[]



[[resources-spas-list]]
=== List All Spas

A `GET` request to will list all of the service's spas.

==== Response structure

include::{snippets}/spas-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/spas-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/spas-list-example/http-response.adoc[]




[[resources-spas-findByDealerId]]
=== Find Spas By Dealer Id

A `GET` request will list all of the spas related to a given dealer.

==== Response structure

include::{snippets}/spas-findbyDealer-example/response-fields.adoc[]

==== Example request

include::{snippets}/spas-findbyDealer-example/curl-request.adoc[]

==== Example response

include::{snippets}/spas-findbyDealer-example/http-response.adoc[]


[[resources-spas-findBOemId]]
=== Find Spas By OEM Id

A `GET` request will list all of the spas related to a given spa manufacturer.

==== Response structure

include::{snippets}/spas-findbyOem-example/response-fields.adoc[]

==== Example request

include::{snippets}/spas-findbyOem-example/curl-request.adoc[]

==== Example response

include::{snippets}/spas-findbyOem-example/http-response.adoc[]


[[resources-spas-findByUsername]]
=== Find Spas By Username

A `GET` request to /spas/search/findByUsername will return the spa associated with a user if it exists.
A 404 error is returned if the user does not exist or is not associated with a spa.

==== Response structure

include::{snippets}/spas-findbyUsername-example/response-fields.adoc[]

==== Example request

include::{snippets}/spas-findbyUsername-example/curl-request.adoc[]

==== Example response

include::{snippets}/spas-findbyUsername-example/http-response.adoc[]



[[resources-spa-retrieve]]
=== Retrieve a spa by Id

*/spas/{id}*

A `GET` request will retrieve the details of a single spa.

==== Response structure

include::{snippets}/spa-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/spa-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/spa-get-example/http-response.adoc[]

[[resources-spas-build]]
=== Build a Spa

*/spas/buildSpa*


A `POST` request is used to create a new spa

==== Request structure

include::{snippets}/spas-build-example/request-fields.adoc[]

 required fields:

 Spa:
 - templateId
 - serialNumber

 Components:
 - serialNumber
 - componentType
 - name


==== Example request

include::{snippets}/spas-build-example/curl-request.adoc[]

==== Response structure

include::{snippets}/spas-build-example/response-fields.adoc[]

==== Example response

include::{snippets}/spas-build-example/http-response.adoc[]



[[resources-spas-sell]]
=== Sell a Spa

*/spas/{spaId}/sellSpa*


A `POST` request is used to sell a spa

==== Request structure

include::{snippets}/spas-sell-example/request-fields.adoc[]

==== Example request

include::{snippets}/spas-sell-example/curl-request.adoc[]

==== Response structure

include::{snippets}/spas-sell-example/response-fields.adoc[]

==== Example response

include::{snippets}/spas-sell-example/http-response.adoc[]




[[resources-spas-recipes]]
=== Save Spa Settings

*/spas/{spaId}/recipes*

A `POST` request is used to save a set of spa settings.

A user may create a set of spa settings used to set the spa to a desired state.
This group of settings can then be executed as a set of spa commands together to achieve the
desired state of the spa.

==== Request structure

include::{snippets}/spas-create-recipe-example/request-fields.adoc[]

The job schedule fields include:

* start date: an optional Date specifying when to begin. Default value is today.
* end date: an optional Date when scheduling should stop.  Default is ongoing indefinately.
* cronExpression: a string representing a cron expression to specify run interval. See: https://en.wikipedia.org/wiki/Cron reference.
* durationMinutes: the length of time to operate the spa in this state
* timeZone: the time zone of the spa
* enabled: boolean flag denoting whether schedule is active

==== Example request

include::{snippets}/spas-create-recipe-example/curl-request.adoc[]

==== Response structure

include::{snippets}/spas-create-recipe-example/response-fields.adoc[]

==== Example response

include::{snippets}/spas-create-recipe-example/http-response.adoc[]


=== List Spa Recipes

*/spas/{spaId}/recipes*

A `GET` request returns a list of recipes related to a spa.

A recipe is set of spa settings used to set the spa to a desired state.
This recipe can then be executed as a set of spa commands together to achieve the
desired state of the spa.


==== Example request

include::{snippets}/recipe-list-example/curl-request.adoc[]

==== Response structure

include::{snippets}/recipe-list-example/response-fields.adoc[]

==== Example response

include::{snippets}/recipe-list-example/http-response.adoc[]

=== Get a Spa Recipe

*/spas/{spaId}/recipes/{id}*

A `GET` request returns a specific recipe related to a spa.


==== Example request

include::{snippets}/recipe-get-example/curl-request.adoc[]

==== Response structure

include::{snippets}/recipe-get-example/response-fields.adoc[]

==== Example response

include::{snippets}/recipe-get-example/http-response.adoc[]

=== Update a Spa Recipe

*/spas/{spaId}/recipes/{id}*

A `PUT` request updates a recipe


==== Example request

include::{snippets}/recipe-put-example/curl-request.adoc[]

==== Response structure

include::{snippets}/recipe-put-example/response-fields.adoc[]

==== Example response

include::{snippets}/recipe-put-example/http-response.adoc[]


=== Delete a Spa Recipe

*/spas/{spaId}/recipes/{id}*

A `DELETE` request removes a spa recipe.


==== Example request

include::{snippets}/recipe-delete-example/curl-request.adoc[]


==== Example response

include::{snippets}/recipe-delete-example/http-response.adoc[]

=== Run a Spa Recipe

*/spas/{spaId}/recipes/{id}/run*

A `POST` request executes a spa recipe.


==== Example request

include::{snippets}/recipe-run-example/curl-request.adoc[]


==== Example response

include::{snippets}/recipe-run-example/http-response.adoc[]





[[resource-faultLog]]
=== Get Fault Logs

A `GET` request to will list all fault logs of selected spa.

==== Response structure

include::{snippets}/faultlog-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/faultlog-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/faultlog-list-example/http-response.adoc[]


[[resource-wifiStat]]
=== Get Wifi Stats

A `GET` request to will list all wifi stats of selected spa.

==== Response structure

include::{snippets}/wifistat-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/wifistat-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/wifistat-list-example/http-response.adoc[]


[[resource-event]]
=== Get Events

A `GET` request to will list all events of selected spa.

==== Response structure

include::{snippets}/event-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/event-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/event-list-example/http-response.adoc[]


[[resource-acCurrentMeasurements]]

=== Get AC Current Measurements

A `GET` request to will list ac current measurements of selected spa.

==== Response structure

include::{snippets}/acCurrentMeasurements-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/acCurrentMeasurements-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/acCurrentMeasurements-list-example/http-response.adoc[]


[[resource-ambientTempMeasurements]]

=== Get Ambient Temp Measurements

A `GET` request to will list ambient temp measurements of selected spa.

==== Response structure

include::{snippets}/ambientTempMeasurements-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/ambientTempMeasurements-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/ambientTempMeasurements-list-example/http-response.adoc[]


[[resources-alert]]
== Alert

The alert resource is used to retrieve, update, and delete individual alerts



[[resources-alert-links]]
=== Links

include::{snippets}/alert-get-example/links.adoc[]



[[resources-alert-retrieve]]
=== Retrieve an alert

A `GET` request will retrieve the details of an alert

==== Response structure

include::{snippets}/alert-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/alert-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/alert-get-example/http-response.adoc[]


[[resources-alert-create]]
=== Creating an alert

A `POST` request is used to create an alert

==== Request structure

include::{snippets}/alert-create-example/request-fields.adoc[]

==== Example request

include::{snippets}/alert-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/alert-create-example/http-response.adoc[]


[[resources-alert-update]]
=== Update an alert

A `PATCH` request is used to update an alert

==== Request structure

include::{snippets}/alert-update-example/request-fields.adoc[]

==== Example request

include::{snippets}/alert-update-example/curl-request.adoc[]

==== Example response

include::{snippets}/alert-update-example/http-response.adoc[]

[[resources-dealer]]
== Dealer

The dealer resource is used to retrieve, update, and delete individual dealers


[[resources-dealer-links]]
=== Links

include::{snippets}/dealer-get-example/links.adoc[]



[[resources-dealer-retrieve]]
=== Retrieve a dealer

A `GET` request will retrieve the details of a dealer

==== Response structure

include::{snippets}/dealer-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/dealer-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/dealer-get-example/http-response.adoc[]


[[resources-dealer-create]]
=== Creating a dealer

A `POST` request is used to create a dealer

==== Request structure

include::{snippets}/dealer-create-example/request-fields.adoc[]

==== Example request

include::{snippets}/dealer-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/dealer-create-example/http-response.adoc[]


[[resources-dealer-update]]
=== Update a dealer

A `PATCH` request is used to update a dealer

==== Request structure

include::{snippets}/dealer-update-example/request-fields.adoc[]

==== Example request

include::{snippets}/dealer-update-example/curl-request.adoc[]

==== Example response

include::{snippets}/dealer-update-example/http-response.adoc[]


[[resources-user]]
== User

The user resource is used to retrieve, update, and delete individual users of the system.


[[resources-user-links]]
=== Links

include::{snippets}/user-get-example/links.adoc[]


=== Listing All Users

*/users*

A `GET` request will list all of the service's users.

==== Response structure

include::{snippets}/users-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/users-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/users-list-example/http-response.adoc[]



[[resources-users-findbydealer]]
=== List Users By Dealer

*/users/search/findByDealerId?dealerId*

This request will list all users associated with a specific dealers.
This includes Dealer Associates, Technicians, Admins,  and spa owners that purchased their spa from the dealer.

==== Request structure

include::{snippets}/users-findbydealer-example/request-parameters.adoc[]

==== Response structure

include::{snippets}/users-findbydealer-example/response-fields.adoc[]

==== Example request

include::{snippets}/users-findbydealer-example/curl-request.adoc[]

==== Example response

include::{snippets}/users-findbydealer-example/http-response.adoc[]


[[resources-users-findbyoem]]
=== List Users By OEM

*/users/search/findByOemId?oemId*

This request will list all users associated with a specific spa manufacturer.
This includes OEM users and admins,  and spa owners that purchased a spa from this
manufacturer.

==== Request structure

include::{snippets}/users-findbyoem-example/request-parameters.adoc[]

==== Response structure

include::{snippets}/users-findbyoem-example/response-fields.adoc[]

==== Example request

include::{snippets}/users-findbyoem-example/curl-request.adoc[]

==== Example response

include::{snippets}/users-findbyoem-example/http-response.adoc[]


[[resources-user-retrieve]]
=== Retrieve a User by Id

*/users/{id}*

A `GET` request will retrieve the details of a user

==== Response structure

include::{snippets}/user-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/user-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/user-get-example/http-response.adoc[]


[[resources-user-findByUserName]]
=== Find User by Username

*/users/search/findByUsername?username*

A `GET` request will retrieve the details of a user given the username assigned to the person.

==== Response structure

include::{snippets}/user-findByUsername-example/response-fields.adoc[]

==== Example request

include::{snippets}/user-findByUsername-example/curl-request.adoc[]

==== Example response

include::{snippets}/user-findByUsername-example/http-response.adoc[]


[[resources-user-create]]
=== Creating a user

*/user-registration*

A `POST` request is used to create a user.
There are different types of users:
- Spa Owners
- Dealer Sales Associates
- Dealer Technicians
- Dealer Administrators
- OEM Users
- Balboa Water Group Users
- System Administrators

==== Request structure

include::{snippets}/user-create-example/request-fields.adoc[]

==== Example request

include::{snippets}/user-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/user-create-example/http-response.adoc[]


[[resources-user-update]]
=== Update a user

*/user-registration/{id}*

A `PUT` request is used to update a user

==== Request structure

include::{snippets}/user-update-example/request-fields.adoc[]

==== Example request

include::{snippets}/user-update-example/curl-request.adoc[]

==== Example response

include::{snippets}/user-update-example/http-response.adoc[]

=== Find Current User

*/auth/whoami*

The /auth/whoami API returns the currently logged in user.
The user is identified by the remote_user request header.

==== Example request

include::{snippets}/whoami-example/curl-request.adoc[]

==== Example response

include::{snippets}/whoami-example/http-response.adoc[]

If the user is a spa owner, a link to the spa is included in the response payload.

=== Mobile Application Authentication

*/idm/tokenEndpoint*

This API returns information related to authenticating a mobile app end user.
The mobile application will use the information in the response, to construct a login POST
to the identity management server which will request an access token to be used in subsequent requests
to the iot-services API.

==== Example request

include::{snippets}/token-endpoint-example/curl-request.adoc[]

==== Example response

include::{snippets}/token-endpoint-example/http-response.adoc[]

==== Response structure
include::{snippets}/token-endpoint-example/response-fields.adoc[]

[%hardbreaks]
The token endpoint is the API to invoke to initiate mobile app authentication.
The refresh endpoint is used to get a new access token if the current token expires.

To Authenticate a mobile app end user: +
{sp} +
Perform a POST on the REST endpoint provided in the tokenEndpoint link.
In the POST, include a Basic Auth http header titled "Authorization". The username and password
values used in creating the basic auth header are the mobileClientId and mobilClientSecret field values. +
The body of the POST must be content type x-www-form-urlencoded and contain 4 fields:

* username: the end user's username
* password: the end user's password
* grant_type: password
* scope: openid

The return payload from successful authentication will include an "access_token", to be used as the
Authentication header in subsequent calls to the iot-services API. This header is an oauth20 header titled
"Authentication". the value of the header must include the string prefix "Bearer " (capital B with a trailing space) followed
by the access_token string.

For example:: Bearer d49736af-f00b-46b9-b7b3-13482c756d73


The first iot-services REST API to call after successful authentication is */auth/whoami*.  This api will return
user details and will include a link to the spa owned by the user.

{sp} +
{sp} +
{sp} +

To Refresh an expired access token: +
Perform a POST on the REST endpoint provided in the refreshEndpoint link.
The body of the POST contains the following fields:

* grant_type: refresh


[[resources-oem]]
== Oem

The oem resource is used to retrieve, update, and delete individual oems



[[resources-oem-links]]
=== Links

include::{snippets}/oem-get-example/links.adoc[]



[[resources-oem-retrieve]]
=== Retrieve an OEM

*/oems/{id}*

A `GET` request will retrieve the details of a Spa Manufacturer

==== Response structure

include::{snippets}/oem-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/oem-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/oem-get-example/http-response.adoc[]


[[resources-oem-create]]
=== Creating an OEM

*/oems*

A `POST` request is used to create an OEM

==== Request structure

include::{snippets}/oem-create-example/request-fields.adoc[]

==== Example request

include::{snippets}/oem-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/oem-create-example/http-response.adoc[]


[[resources-oem-update]]
=== Update an OEM

*/oems/{id}*

A `PATCH` request is used to update a spa manufacturer.

==== Request structure

include::{snippets}/oem-update-example/request-fields.adoc[]

==== Example request

include::{snippets}/oem-update-example/curl-request.adoc[]

==== Example response

include::{snippets}/oem-update-example/http-response.adoc[]



[[resources-spa-commands]]
== Spa Control Commands

The following commands are available to control the spa.

[[resources-control-desired-temp]]
=== Set the desired spa temperature

This command is used to remotely control the spa temperature

==== Request structure

include::{snippets}/control-desired-temp-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-desired-temp-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-desired-temp-example/http-response.adoc[]


=== Jet Control

This command is used to turn the spa jets ON and OFF

==== Request structure

include::{snippets}/control-pump-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-pump-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-pump-example/http-response.adoc[]


=== Circ Pump Control

This command is used to set state of circulation pump: OFF, LOW, HIGH.

==== Request structure

include::{snippets}/control-circpump-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-circpump-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-circpump-example/http-response.adoc[]


=== Spa Lights Control

This command is used to turn the spa lights ON and OFF

==== Request structure

include::{snippets}/control-light-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-light-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-light-example/http-response.adoc[]


=== Blower Control

This command turns the spa blower(s) ON and OFF

==== Request structure

include::{snippets}/control-blower-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-blower-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-blower-example/http-response.adoc[]


=== Mister Control

This command turns the mister(s) ON and OFF

==== Request structure

include::{snippets}/control-mister-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-mister-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-mister-example/http-response.adoc[]


=== Ozone Control

This command turns the ozone ON and OFF

==== Request structure

include::{snippets}/control-ozone-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-ozone-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-ozone-example/http-response.adoc[]


=== Microsilk Control

This command turns the microsilk ON and OFF

==== Request structure

include::{snippets}/control-microsilk-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-microsilk-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-microsilk-example/http-response.adoc[]


=== Aux Control

This command turns the aux ON and OFF

==== Request structure

include::{snippets}/control-aux-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-aux-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-aux-example/http-response.adoc[]


=== Filter Cycle Control

This command turns the filter cycle ON and OFF.
The filter cycle is designed to run in intervals of 15 minutes, and then turn itself off.
To turn the filter ON and initiate the filter cycle, set the interval parameter to be 1 or greater.
To turn the filter OFF, set the interval parameter to zero.

==== Request structure

include::{snippets}/control-filtercycle-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

The following example illustrates initiating a filter cycle of 30 minutes.
include::{snippets}/control-filtercycle-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-filtercycle-example/http-response.adoc[]


=== Agent Restart

This command restarts the agent

==== Request structure

include::{snippets}/control-agentrestart-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-agentrestart-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-agentrestart-example/http-response.adoc[]


=== Gateway Reboot

This command reboots the agteway

==== Request structure

include::{snippets}/control-gatewayreboot-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-gatewayreboot-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-gatewayreboot-example/http-response.adoc[]


=== Gateway Agent Runtime Settings

This command sets some fo the agent's runtime settings

==== Request structure

include::{snippets}/control-agentsettings-example/request-fields.adoc[]

If the originatorId is not sent in the request, one will be created

==== Example request

include::{snippets}/control-agentsettings-example/curl-request.adoc[]

==== Example response

include::{snippets}/control-agentsettings-example/http-response.adoc[]


[[resources-tac]]
== Terms And Agreements

The following APIs are for managing Terms and Conditions and User Agreements.

[[resources-tac-create]]
=== Create New Terms and Conditions

Creating a new Terms and Conditions resource, will mark any existing terms and conditions
as old.   All current user agreements will also be marked as old.

==== Request structure

include::{snippets}/tac-create-example/request-fields.adoc[]


==== Example request

include::{snippets}/tac-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/tac-create-example/http-response.adoc[]

=== Get Most Recent Terms and Conditions

This method will retrieve the active terms and agreements.

==== Example request

include::{snippets}/tac-findMostRecent-example/curl-request.adoc[]

==== Response structure

include::{snippets}/tac-findMostRecent-example/response-fields.adoc[]

==== Example response

include::{snippets}/tac-findMostRecent-example/http-response.adoc[]


=== Agree to Terms and Conditions

For a user to agree to the terms and conditions.

==== Request structure

include::{snippets}/tac-agree-example/request-fields.adoc[]


==== Example request

include::{snippets}/tac-agree-example/curl-request.adoc[]

==== Response structure

include::{snippets}/tac-agree-example/response-fields.adoc[]

==== Example response

include::{snippets}/tac-agree-example/http-response.adoc[]


=== Find Current User Agreement

Find the current Terms and Conditions Agreement for give userId.
Return Error Code 404 if no current agreement found.

==== Example request

include::{snippets}/tac-findAgreement-example/curl-request.adoc[]

==== Response structure

include::{snippets}/tac-findAgreement-example/response-fields.adoc[]

==== Example response

include::{snippets}/tac-findAgreement-example/http-response.adoc[]


[[resources-component]]
== Spa Components

The component entity represents spa parts. The various parts used to build a spa.


[[resources-component-links]]
=== Links

include::{snippets}/component-get-example/links.adoc[]


[[resources-component-list]]
=== Listing All Components

A `GET` request will list all of the components for all of the spas in the system

==== Response structure

include::{snippets}/components-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/components-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/components-list-example/http-response.adoc[]


[[resources-component-findBySpaId]]
=== List Components of a Spa

A `GET` request will retrieve the a list of components associated with a single spa

==== Response structure

include::{snippets}/components-findbySpaId-example/response-fields.adoc[]

==== Example request

include::{snippets}/components-findbySpaId-example/curl-request.adoc[]

==== Example response

include::{snippets}/components-findbySpaId-example/http-response.adoc[]


[[resources-component-findbySpaIdAndComponentType]]
=== List Components of a single type for Spa

A `GET` request will retrieve the a list components of a certain type associated with a single spa.
Component types include:  GATEWAY, MOTE, PUMP, LIGHT, BLOWER, MISTER, FILTER, AUX, PANEL, OZONE, MICROSILK, CONTROLLER

==== Response structure

include::{snippets}/components-findbySpaIdAndComponentType-example/response-fields.adoc[]

==== Example request

include::{snippets}/components-findbySpaIdAndComponentType-example/curl-request.adoc[]

==== Example response

include::{snippets}/components-findbySpaIdAndComponentType-example/http-response.adoc[]


[[resources-component-findBySerialNumber]]
=== Find Component By Serial Number

A `GET` request will retrieve the details of a component with the given serial number.

==== Response structure

include::{snippets}/components-findbySerialNumber-example/response-fields.adoc[]

==== Example request

include::{snippets}/components-findbySerialNumber-example/curl-request.adoc[]

==== Example response

include::{snippets}/components-findbySerialNumber-example/http-response.adoc[]


[[resources-component-retrieve]]
=== Retrieve a Component by its Id

A `GET` request will retrieve the details of a specific component

==== Response structure

include::{snippets}/component-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/component-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/component-get-example/http-response.adoc[]


[[resources-component-create]]
=== Creating a Spa Component

A `POST` request is used to create a component

==== Request structure

include::{snippets}/component-create-example/request-fields.adoc[]

==== Example request

include::{snippets}/component-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/component-create-example/http-response.adoc[]

[[resources-component-update]]
=== Update a component

A `PATCH` request is used to update a component

==== Request structure

include::{snippets}/component-update-example/request-fields.adoc[]

==== Example request

include::{snippets}/component-update-example/curl-request.adoc[]

==== Example response

include::{snippets}/component-update-example/http-response.adoc[]




[[resources-material]]
== Spa Materials

The material entity represents type of spa parts available for use 
in designing or building a spa.

Balboa makes several variations of all types of components used to build a spa.
Each OEM is under contract to use a specific set of components. 



[[resources-material-links]]
=== Links

include::{snippets}/material-get-example/links.adoc[]


[[resources-material-list]]
=== Listing All Materials

*/materials*

A `GET` request will list all of the materials for all of the spas in the system.
This API is intended for use only by users with BWG role. 

==== Response structure

include::{snippets}/materials-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/materials-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/materials-list-example/http-response.adoc[]


[[resources-material-findByOemId]]
=== List Materials associated with a single OEM

*/materials/search/findByOemId*

A `GET` request will retrieve the a list of materials associated with a single manufacturer.

==== Response structure

include::{snippets}/materials-findbyOemId-example/response-fields.adoc[]

==== Example request

include::{snippets}/materials-findbyOemId-example/curl-request.adoc[]

==== Example response

include::{snippets}/materials-findbyOemId-example/http-response.adoc[]


[[resources-material-findbyOemIdAndComponentType]]
=== List Materials of a single Component Type available to an OEM

*/materials/search/findByOemIdAndComponentType*

A `GET` request will retrieve the a list materials of a certain type associated with a single OEM.

Component types include:  GATEWAY, MOTE, PUMP, LIGHT, BLOWER, MISTER, FILTER, AUX, PANEL, OZONE, MICROSILK, CONTROLLER

==== Response structure

include::{snippets}/materials-findbyOemIdAndComponentType-example/response-fields.adoc[]

==== Example request

include::{snippets}/materials-findbyOemIdAndComponentType-example/curl-request.adoc[]

==== Example response

include::{snippets}/materials-findbyOemIdAndComponentType-example/http-response.adoc[]


[[resources-material-findBySku]]
=== Find Material By SKU

*/materials/search/findBySku*

A `GET` request will retrieve the details of a material with the given SKU.

==== Response structure

include::{snippets}/materials-findbySku-example/response-fields.adoc[]

==== Example request

include::{snippets}/materials-findbySku-example/curl-request.adoc[]

==== Example response

include::{snippets}/materials-findbySku-example/http-response.adoc[]


[[resources-material-retrieve]]
=== Retrieve a Material by its Id

*/materials/{_id}*

A `GET` request will retrieve the details of a specific material item.

==== Response structure

include::{snippets}/material-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/material-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/material-get-example/http-response.adoc[]


[[resources-spaTemplate]]
== Spa Template

A SpaTemplate describes the makeup of a specific model of spa.

A SpaTemplate is created by a Spa Designer at an OEM.
OEM users that build spas, use the SpaTemplate to know which components are to be used in creating the spa.


[[resources-templatelist-links]]
=== Links

include::{snippets}/template-get-example/links.adoc[]


[[resources-template-list]]
=== List All Spa Templates

*/spaTemplates*

A `GET` request will list all of the spa templates for all of the OEMs in the system.
This API is intended for use only by users with BWG role.

==== Response structure

include::{snippets}/template-list-example/response-fields.adoc[]

==== Example request

include::{snippets}/template-list-example/curl-request.adoc[]

==== Example response

include::{snippets}/template-list-example/http-response.adoc[]


[[resources-templates-findByOemId]]
=== List Spa Templates associated with a single OEM

*/spaTemplates/search/findByOemId*

A `GET` request will retrieve the a list of spa templates associated with a single manufacturer.

==== Response structure

include::{snippets}/templates-findbyOem-example/response-fields.adoc[]

==== Example request

include::{snippets}/templates-findbyOem-example/curl-request.adoc[]

==== Example response

include::{snippets}/templates-findbyOem-example/http-response.adoc[]


[[resources-template-retrieve]]
=== Retrieve a Spa Template by its Id

*/spaTemplates/{_id}*

A `GET` request will retrieve the details of a spa template.

==== Response structure

include::{snippets}/template-get-example/response-fields.adoc[]

==== Example request

include::{snippets}/template-get-example/curl-request.adoc[]

==== Example response

include::{snippets}/template-get-example/http-response.adoc[]

[[resources-template-create]]
=== Creating a Spa Template

*/spaTemplates*

A `POST` request is used to create a spa template

==== Request structure

include::{snippets}/template-create-example/request-fields.adoc[]

==== Example request

include::{snippets}/template-create-example/curl-request.adoc[]

==== Example response

include::{snippets}/template-create-example/http-response.adoc[]



[[resources-attachment-create]]
=== Adding an attachment

A `POST` multipart form with params 'name' and 'attachmentFile'.

==== Example request

include::{snippets}/attachment-upload-example/curl-request.adoc[]

==== Example response

include::{snippets}/attachment-upload-example/http-response.adoc[]


[[resources-attachment-get]]
=== Obtaining an attachment file

A `GET` will return a binary data that was sent in POST request.

==== Example request

include::{snippets}/attachment-get-example/curl-request.adoc[]


[[resources-attachment-delete]]
=== Deleting an attachment

A `DELETE` removes given attachment.

==== Example request

include::{snippets}/attachment-delete-example/curl-request.adoc[]


[[resources-template-delete]]
=== Deleting a Spa Template

*/spaTemplates/{id}/remove*

A `POST` to the remove method is used to delete a spa template.

If a template has not ever been used to build a spa, it will be deleted from the database,
the response code will be  204 (NO_CONTENT)

If a template has already been used to build a spa. It will simply be marked as inactive.
It will remain in the database, but will no longer show up on the list of templates for an
OEM to use to build new spas. The response code, in this case, will be 200 (OK) and will return
the updated spa template in the response.

==== Example request

include::{snippets}/template-delete-example/curl-request.adoc[]

==== Example response when Spa Template has never been used

include::{snippets}/template-delete-example/http-response.adoc[]

==== Example response when Spa Template has already been used to build a spa

include::{snippets}/template-archive-example/http-response.adoc[]



[[resources-utilities]]
== Utilities

The utilities controller handles miscellaneous utility APIs.

=== System Settings

*/util/systemSettings*

This API returns various system settings for the iot-services application.

==== Example request

include::{snippets}/system-settings-example/curl-request.adoc[]

==== Example response

include::{snippets}/system-settings-example/http-response.adoc[]

==== Response structure
include::{snippets}/system-settings-example/response-fields.adoc[]

